buildscript {
    repositories {
        maven { url "https://jitpack.io" }
        maven { url "https://maven.oschina.net/content/groups/public/" }
        maven { url 'https://plugins.gradle.org/m2/' }
        maven { url 'https://maven.aliyun.com/repository/google/' }
        mavenLocal()
        mavenCentral()
    }
}

plugins {
    id 'groovy-gradle-plugin'
    id 'org.jetbrains.kotlin.jvm' version "1.3.72"
//    id 'org.jlleitschuh.gradle.ktlint' version '9.2.1'
}
apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: "java-gradle-plugin"
gradlePlugin {
    plugins {
        perfplugin {
            id = 'com.jamesfchen.perf-plugin'
            implementationClass = 'com.jamesfchen.perf.PerfPlugin'
        }
        lifecycleplugin {
            id = 'com.jamesfchen.lifecycle-plugin'
            implementationClass = 'com.jamesfchen.lifecycle.InjectLifecyclePlugin'
        }
        testplugin {
            id = 'com.jamesfchen.test-plugin'
            implementationClass = 'com.jamesfchen.TestPlugin'
        }
        testkotlinplugin {
            id = 'com.jamesfchen.test-kotlin-plugin'
            implementationClass = 'com.jamesfchen.TestKotlinPlugin'
        }
        ibcplugin {
            id = 'com.jamesfchen.ibc-plugin'
            implementationClass = 'com.jamesfchen.ibc.IbcPlugin'
        }
        proguardplugin {
            id = 'com.jamesfchen.proguard-plugin'
            implementationClass = 'com.jamesfchen.proguard.ProGuardPlugin'
        }
    }
}
dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation gradleApi()
    implementation localGroovy()
    implementation "androidx.annotation:annotation:1.2.0"
    implementation "com.android.tools.build:gradle:4.1.2"
    implementation "org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.10"
//    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.3.50"
//    implementation "org.javassist:javassist:3.20.0-GA"
//    implementation group: 'org.ow2.asm', name: 'asm', version: '5.1'
//    implementation group: 'org.ow2.asm', name: 'asm-commons', version: '5.1'
    implementation files('libs/buglySymbolAndroid.jar')
}
tasks.withType(GroovyCompile) {
    sourceCompatibility = '1.8'
    targetCompatibility = '1.8'
}
java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}
compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

//compileTestKotlin {
//    kotlinOptions.jvmTarget = "1.8"
//}
configurations {
    compileOnly
}

sourceSets {
    main {
        compileClasspath += configurations.compileOnly
    }
}
def srcDirs = [
        'lifecycle',
        'perf',
        'base',
        'ibc',
        'proguard',
]
sourceSets {
    main {
        java.excludes = [
                '**/build/**',
        ]
        srcDirs.forEach {
            resources.srcDirs += "src/$it/resources"
            java.srcDirs += "src/$it/java"
            groovy.srcDirs += "src/$it/groovy"
            kotlin.srcDirs += "src/$it/kotlin"
        }
    }
}